type YieldClaimedSnapshot @entity(timeseries: true) {
  id: Int8!
  timestamp: Timestamp!
  amount: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
  logIndex: BigInt!
}

type ReceivedSnapshot @entity(immutable: true) {
  id: ID! @unique
  timestamp: Timestamp!
  account: Holder!
  amount: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
  logIndex: BigInt!
}

type SentSnapshot @entity(immutable: true) {
  id: ID! @unique
  timestamp: Timestamp!
  account: Holder!
  amount: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
  logIndex: BigInt!
}

type Holder @entity(immutable: false) {
  id: Bytes! @unique
  received: BigInt!
  receivedSnapshots: [ReceivedSnapshot!] @derivedFrom(field: "account")
  sent: BigInt!
  sentSnapshots: [SentSnapshot!] @derivedFrom(field: "account")
  lastUpdate: Timestamp!
}

enum Operation {
  MINT
  BURN
}

type StablecoinSupply @entity(timeseries: true) {
  id: Int8!
  timestamp: Timestamp!
  amount: BigInt!
  stablecoin: Stablecoin!
  blockNumber: BigInt!
  transactionHash: Bytes!
  logIndex: BigInt!
  delta: BigDecimal!
  operation: Operation!
}

type StablecoinSupplyStats
  @aggregation(intervals: ["day"], source: "StablecoinSupply") {
  id: Int8!
  timestamp: Timestamp!
  totalSupply: BigDecimal! @aggregate(fn: "last", arg: "amount")
  blockNumber: BigInt!
  transactionHash: Bytes!
  count: Int8! @aggregate(fn: "count", cumulative: true)
}

type Stablecoin @entity(immutable: false) {
  id: Bytes! @unique # address
  holders: [Holder!]
  transfers: [Transfer!]
  yieldClaimed: BigInt!
  yieldClaimedSnapshots: [YieldClaimedSnapshot!]
  minted: BigInt!
  burned: BigInt!
  lastUpdate: Timestamp!
}

type Transfer @entity(immutable: true) {
  id: Bytes!
  sender: Bytes! # address
  recipient: Bytes! # address
  amount: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}
